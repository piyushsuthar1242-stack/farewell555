<!DOCTYPE html>
<html>
<head>
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(120deg,#0f2027,#203a43,#2c5364);
color:white;
}

.container{
width:95%;
max-width:1400px;
margin:20px auto;
background:rgba(255,255,255,0.05);
padding:20px;
border-radius:12px;
}

h2{text-align:center;}

.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
gap:12px;
margin:20px 0;
}

.card{
padding:15px;
border-radius:10px;
text-align:center;
cursor:pointer;
background:linear-gradient(45deg,#00c6ff,#0072ff);
font-weight:bold;
}

.card:hover{transform:scale(1.05);}

input,select{
width:100%;
padding:12px;
margin:8px 0;
border:none;
border-radius:6px;
}

button{
padding:12px;
border:none;
border-radius:6px;
cursor:pointer;
margin:5px 0;
}

.excelBtn{
background:#00c6ff;
width:100%;
font-weight:bold;
}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
background:rgba(0,0,0,0.3);
border-radius:10px;
overflow:hidden;
}

th,td{
padding:10px;
text-align:center;
}

th{background:#00c6ff;color:black;}

.deleteBtn{
background:red;
color:white;
}
</style>
</head>

<body>

<div id="loginDiv" class="container">
<h2>Admin Login</h2>
<input type="password" id="password" placeholder="Enter Password">
<button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none" class="container">

<h2>Student Admin Dashboard</h2>
<h3>Total Students: <span id="totalCount">0</span></h3>

<div class="cards" id="classCards"></div>

<input type="text" id="search" placeholder="Search name..." onkeyup="loadData()">

<button class="excelBtn" onclick="downloadExcel()">Download Excel</button>

<table>
<thead>
<tr>
<th>Name</th>
<th>Roll</th>
<th>Class</th>
<th>Email</th>
<th>Phone</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

</div>

<script>
var firebaseConfig = {
apiKey: "AIzaSyBIdKRuJo_oSR-PV4K4svr9YojA7g-Vgj4",
authDomain: "party-4f9f7.firebaseapp.com",
projectId: "party-4f9f7",
storageBucket: "party-4f9f7.firebasestorage.app",
messagingSenderId: "615273128511",
appId: "1:615273128511:web:d99127fa938f13658c4e8a"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

var classes = [
"FYBCA","SYBCA","TYBCA",
"FYBBA","SYBBA","TYBBA",
"FYBCOM","SYBCOM","TYBCOM",
"BBA","BCOM"
];

var selectedClass="ALL";

function login(){
var pass=document.getElementById("password").value;
if(pass==="admin123"){
document.getElementById("loginDiv").style.display="none";
document.getElementById("panel").style.display="block";
createCards();
loadData();
}else{
alert("Wrong Password");
}
}

function createCards(){
let div=document.getElementById("classCards");
div.innerHTML='<div class="card" onclick="filterClass(\'ALL\')">All</div>';

classes.forEach(c=>{
div.innerHTML+=`<div class="card" onclick="filterClass('${c}')">${c}</div>`;
});
}

function filterClass(cls){
selectedClass=cls;
loadData();
}

function loadData(){
let body=document.getElementById("tableBody");
body.innerHTML="";
let search=document.getElementById("search").value.toLowerCase();

db.collection("students").get().then(snapshot=>{
let count=0;

snapshot.forEach(doc=>{
let d=doc.data();

if((selectedClass==="ALL" || d.class===selectedClass) &&
(!search || d.name.toLowerCase().includes(search))){

count++;

body.innerHTML+=`
<tr>
<td>${d.name}</td>
<td>${d.roll}</td>
<td>${d.class}</td>
<td>${d.email}</td>
<td>${d.phone}</td>
<td><button class="deleteBtn" onclick="deleteData('${doc.id}')">Delete</button></td>
</tr>`;
}
});

document.getElementById("totalCount").innerText=count;
});
}

function deleteData(id){
if(confirm("Delete student?")){
db.collection("students").doc(id).delete().then(loadData);
}
}

function downloadExcel(){
let csv="Name,Roll,Class,Email,Phone\n";

db.collection("students").get().then(snapshot=>{
snapshot.forEach(doc=>{
let d=doc.data();
csv+=`${d.name},${d.roll},${d.class},${d.email},${d.phone}\n`;
});

let blob=new Blob([csv]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="students.csv";
a.click();
});
}
</script>

</body>
</html>
