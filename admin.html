<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

body{
margin:0;
font-family:Arial, sans-serif;
background:linear-gradient(135deg,#1e3c72,#2a5298);
}

/* Header */
.header{
background:#0d1b3d;
color:white;
padding:15px;
text-align:center;
font-size:20px;
font-weight:bold;
}

/* Login */
.loginBox{
text-align:center;
margin-top:120px;
}

input,select{
padding:10px;
margin:6px;
border-radius:8px;
border:none;
width:220px;
max-width:90%;
}

button{
padding:10px 16px;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer;
}

.loginBtn{ background:orange; }

/* Panel */
.container{
display:none;
max-width:1100px;
margin:15px auto;
background:white;
border-radius:12px;
padding:15px;
box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

/* Cards */
.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:10px;
margin-bottom:15px;
}

.card{
background:#1e3c72;
color:white;
padding:15px;
border-radius:10px;
font-size:16px;
text-align:center;
font-weight:bold;
}

/* Controls */
.controls{
display:flex;
flex-wrap:wrap;
gap:8px;
justify-content:space-between;
margin-bottom:10px;
}

.controls div{
display:flex;
flex-wrap:wrap;
gap:6px;
}

/* Table */
.tableBox{
overflow-x:auto;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#1e3c72;
color:white;
padding:10px;
}

td{
padding:10px;
border-bottom:1px solid #ddd;
text-align:center;
}

.deleteBtn{
background:red;
color:white;
padding:6px 10px;
border-radius:6px;
}

.downloadBtn{
background:#28a745;
color:white;
}

</style>
</head>

<body>

<div class="header">ðŸŽ‰ Farewell Party Admin Dashboard</div>

<!-- LOGIN -->
<div class="loginBox" id="loginBox">
<input type="password" id="pass" placeholder="Enter Password">
<br>
<button class="loginBtn" onclick="login()">Login</button>
</div>

<!-- PANEL -->
<div class="container" id="panel">

<!-- DASHBOARD CARDS -->
<div class="cards">
<div class="card">Total<br><span id="totalCount">0</span></div>
<div class="card">BCA<br><span id="bcaCount">0</span></div>
<div class="card">BCOM<br><span id="bcomCount">0</span></div>
<div class="card">BBA<br><span id="bbaCount">0</span></div>
</div>

<div class="controls">

<div>
<input type="text" id="search" placeholder="Search Name" onkeyup="loadData()">

<select id="classFilter" onchange="loadData()">
<option value="All">All Classes</option>
<option>FYBCA</option>
<option>SYBCA</option>
<option>TYBCA</option>
<option>FYBCOM</option>
<option>SYBCOM</option>
<option>TYBCOM</option>
<option>FYBBA</option>
<option>SYBBA</option>
<option>TYBBA</option>
</select>
</div>

<button class="downloadBtn" onclick="downloadExcel()">Download Excel</button>

</div>

<div class="tableBox">
<table>
<thead>
<tr>
<th>Name</th>
<th>Roll</th>
<th>Class</th>
<th>Email</th>
<th>Phone</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>

<script>

var firebaseConfig = {
apiKey: "AIzaSyBIdKRuJo_oSR-PV4K4svr9YojA7g-Vgj4",
authDomain: "party-4f9f7.firebaseapp.com",
projectId: "party-4f9f7",
storageBucket: "party-4f9f7.firebasestorage.app",
messagingSenderId: "615273128511",
appId: "1:615273128511:web:d99127fa938f13658c4e8a"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

let excelData=[];

/* LOGIN */
function login(){
let pass=document.getElementById("pass").value;
if(pass=="admin123"){
document.getElementById("loginBox").style.display="none";
document.getElementById("panel").style.display="block";
loadData();
}else{
alert("Wrong Password");
}
}

/* LOAD DATA */
function loadData(){

let search=document.getElementById("search").value.toLowerCase();
let selected=document.getElementById("classFilter").value;

let tbody=document.getElementById("tbody");
tbody.innerHTML="";
excelData=[];

let total=0, bca=0, bcom=0, bba=0;

db.collection("students").get().then(snapshot=>{
snapshot.forEach(doc=>{

let d=doc.data();
d.id=doc.id;

if(d.class.includes("BCA")) bca++;
if(d.class.includes("BCOM")) bcom++;
if(d.class.includes("BBA")) bba++;
total++;

if((selected=="All" || d.class==selected) &&
(d.name.toLowerCase().includes(search))){

excelData.push({
Name:d.name,
Roll:d.roll,
Class:d.class,
Email:d.email,
Phone:d.phone
});

tbody.innerHTML+=`
<tr>
<td>${d.name}</td>
<td>${d.roll}</td>
<td>${d.class}</td>
<td>${d.email}</td>
<td>${d.phone}</td>
<td><button class="deleteBtn" onclick="deleteStudent('${d.id}')">Delete</button></td>
</tr>`;
}

});

document.getElementById("totalCount").innerText=total;
document.getElementById("bcaCount").innerText=bca;
document.getElementById("bcomCount").innerText=bcom;
document.getElementById("bbaCount").innerText=bba;

});
}

/* DELETE */
function deleteStudent(id){
if(confirm("Delete student?")){
db.collection("students").doc(id).delete().then(loadData);
}
}

/* EXCEL */
function downloadExcel(){
var ws=XLSX.utils.json_to_sheet(excelData);
var wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Students");
XLSX.writeFile(wb,"Students.xlsx");
}

</script>
</body>
</html>
